# 세마포어와 뮤텍스

> 여러 프로세스나 쓰레드가 공유 자원에 접근하는 것을 제어하기 위한 방법, 병행 처리를 위한 프로세스 동기화 기법

동시성 프로그래밍의 가장 큰 숙제는 ‘공유자원 관리’ 이다. 공유자원을 안전하게 관리하기 위해서는 상호배제(Mutual exclusion)를 달성하는 기법이 필요하다.

뮤텍스와 세마포어는 이를 위해 고안된 기법으로 서로 다른 방식으로 상호배제를 달성한다.


## 뮤텍스

임계구역(Critical Section)을 가진 스레드들의 실행시간(Running Time)이 서로 겹치지 않고 각각 단독으로 실행(상호배제_Mutual Exclution)되도록 하는 기술

한 프로세스에 의해 소유될 수 있는 Key를 기반으로 한 상호배제 기법

Key에 해당하는 어떤 객체(Object)가 있으며, 이 객체를 소유한 스레드/프로세스만이 공유자원에 접근할 수 있다.

다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 동기화(Synchronization) 또는 락(Lock)을 사용.

즉, 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.

식당의 화장실 열쇠(key object)라고 비유한 블로그가 인상이 깊어서 [링크](https://worthpreading.tistory.com/90)로 남긴다.


## 세마포어

공유자원의 상태를 나타낼 수 있는 카운터(운영체제 또는 커널에 지정된 저장장치 내의 값)로 생각할 때, 사용하고 있는 스레드/프로세스의 수를 공통으로 관리하는 하나의 값을 이용해 상호배제를 달성한다.

공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근할 수 있다.

각 프로세스는 세마포어의 값을 확인하고 변경할 수 있다.

자원을 사용하지 않는 상태가 될 때, 대기하던 프로세스가 즉시 자원을 사용한다.

이미 다른 프로세스에 의해 사용중이라는 사실을 알게 되면, 재시도 전에 일정시간 대기해야 한다.

세마포어를 사용하는 프로세스는 그 값을 확인하고, 자원을 사용하는 동안에는 그 값을 변경함으로써 다른 세마포어 사용자들이 대기하도록 해야 한다.

유닉스 프로그래밍에서 세마포어는 운영체제의 리소스를 경쟁적으로 사용하는 다중 프로세스에서 행동을 조정하거나 또는 동기화하는 기술
  
  
## 뮤텍스와 세마포어의 차이점

자원소유여부
- Mutex는 자원 소유 가능 + 책임을 가지는 반면, Semaphore는 자원 소유 불가
- 현재 수행중인 프로세스가 아닌 다른 프로세스가 세마포어를 해제할 수 있습니다. 하지만 뮤텍스는 락(lock)을 획득한 프로세스가 반드시 그 락을 해제해야 합니다.
- 뮤텍스는 소유하고 있는 프로세스(스레드)만이 이 뮤텍스를 해제할 수 있다.

`동기화` 대상의 갯수
- 세마포어는 공유 자원에 세마포어의 변수만큼의 프로세스(또는 쓰레드)가 접근할 수 있습니다. 반면에 뮤텍스는 오직 1개만의 프로세스(또는 쓰레드)만 접근할 수 있습니다.(Lock)
- 뮤텍스는 동기화 대상이 only 1개일 때 사용, 세마포어는 동기화 대상이 1개 이상일 때 사용

Semaphore는 시스템 범위에 걸쳐 있고, 파일 시스템 상의 파일로 존재한다.
반면, Mutex는 프로세스의 범위를 가지며 프로세스 종료될 때 자동으로 Clean up 된다.


_참고_
- https://worthpreading.tistory.com/90
- https://chelseashin.tistory.com/40
