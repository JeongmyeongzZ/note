# 샤딩 (Sharding) ?

shard의 사전적 의미는 (유리·금속 등의) 조각, 파편이다. 데이터베이스의 측면에서 본다면 sharding은 데이터베이스를 조각으로 나누는 것으로 생각해볼 수 있다.

샤딩(sharding)은 horizontal partitioning과 관련된 데이터베이스 설계 패턴이다. 한 테이블의 row들을 여러 개의 서로 다른 테이블, 즉 파티션으로 분리하는 것을 말한다.

shards는 샤딩을 통해 나누어진 블록들을 말한다. 샤딩은 데이터를 작은 덩어리(smaller chunks)로 쪼개는 것이고, 이 작은 덩어리를 logical shards라고 부른다. logical shards는 분리된 physical shard, 즉 database node에 뿌려진다.

database node: 데이터베이스의 인스턴스를 말한다. main node는 쓰기, 그 외의 노드는 읽기 전용으로 사용되는 것이 전형적이다. main node를 변경했을 때 나머지 node들은 그에 따라 변하게 되는 구조다.


## 파티셔닝 (Partitioning) ?
 
horizontal partitioning의 경우 한 테이블의 row들을 여러 개의 서로 다른 테이블, 즉 파티션으로 분리하는 것을 말한다.
vertical partitioning의 경우 열 전체가 완전히 새로운 테이블로 분리되기 때문에, 테이블 내의 데이터들은 독립적이며 열과 행이 모두 달라진다.
 
 
### HP(Horizontal Partitioning)과 샤딩(Sharding) 비교

수평 분할(Horizontal Partitioning)이란 스키마가 같은 데이터를 두 개 이상의 테이블에 나누어 저장하는 디자인을 말한다. 

인덱스의 크기를 줄이고, 작업 동시성을 늘리기 위한 것이다. 보통 수평 분할을 한다고 했을 때는 하나의 데이터베이스 안에서 이루어지는 경우를 지칭한다.

이에 비해, 샤딩은 물리적으로 다른 데이터베이스에 데이터를 수평 분할 방식으로 분산 저장하고 조회하는 방법을 말한다. ‘

여러 데이터베이스를 대상으로 작업해야 하기 때문에 경우에 따라서는 (JOIN 등) 기능에 제약이 있을 수 있고 일관성(consistency)과 복제(replication) 등에서 불리한 점이 많다. 
예전의 샤딩은 애플리케이션 서버 레벨에서 구현하는 경우가 많았지만 최근에는 이를 플랫폼 차원에서 제공한다.

NoSql 에서 주로 사용되는 용어이다.

샤드당 Read Replica 라는 표현도 Nosql 에서 자주 사용되는 용어인데, 이는 무엇일까?


## 레플리케이션, 복제 (Replication) ?

샤딩은과 레플리케이션은 거의 반대 개념이다. 그렇지만 모두 scale-out 에 해당하는 성능 개선 기법이다.

파티셔닝이라고도 하는 샤딩은 데이터를 키로 분할하는 것이고, 미러링이라고도 하는 레플리케이션(복제)는 모든 데이터를 복사하는 것이다.

샤딩은 성능을 향상시켜 한 리소스에 대한 적중 및 메모리 로드를 줄이는 데 유용합니다. (쓰기 기능 증대) 

복제는 읽기의 고가용성(HA)을 확보하는 데 유용합니다. 여러 복제본에서 읽는 경우 모든 리소스의 적중률도 감소하지만 모든 리소스에 대한 메모리 요구 사항은 동일하게 유지됩니다.  (읽기 기능 증대)

한개의 마스터에 여러개의 리플리카 노드가 붙을 수 있고, 리플리카 노드에 또 다른 리플리카 노드가 연결되는 것도 가능합니다. 
하지만 한 개의 복제그룹에서는 항상 한 개의 마스터 노드만 존재합니다. 다중 마스터의 구조로 양쪽으로 데이터를 복제하는 등의 구조는 불가능합니다.

샤드당 리드 레플리카가 다수 존재할 수 있다고 볼 수 있다.




_참고_
- https://velog.io/@matisse/Database-sharding%EC%97%90-%EB%8C%80%ED%95%B4
- https://seokbeomkim.github.io/posts/partition-and-sharding/#%EC%83%A4%EB%94%A9-sharding
- https://cla9.tistory.com/102
