Jar 파일을 실행하는데, 최소 할당 메모리와 최대 할당 메모리를 지정하는 옵션이 있다.

-Xms 설정은 Java 힙의 초기 크기를 제어합니다. 
이 매개변수를 적절하게 조정하면 가비지 콜렉션의 오버헤드를 줄여서 서버 응답 시간 및 처리량을 개선합니다. 
일부 응용프로그램의 경우, 이 옵션에 대한 기본 설정이 너무 낮아서 사소한 가비지 콜렉션의 수가 높아질 수 있습니다.

-Xmx 설정은 Java 힙의 최대 크기를 제어합니다. 
이 매개변수를 늘리면 Application Server 에 사용 가능한 메모리가 늘어나고 가비지 콜렉션 빈도가 줄어듭니다. 
이 설정을 늘리면 서버 응답 시간 및 처리량이 개선될 수 있습니다. 
그러나 이 설정을 늘리면 가비지 콜렉션이 발생할 때 해당 콜렉션의 지속 기간이 늘어납니다. 
이 설정은 Application Server 인스턴스에 대해 사용 가능한 시스템 메모리 이상으로 증가해서는 안됩니다. 
설정을 사용 가능한 시스템 메모리 이상으로 늘리면 시스템 페이징 및 상당한 성능 감소를 유발할 수 있습니다.

---

적은 값의 -Xms 옵션으로 Java를 실행하게 되면, 결국엔 더 자주 GC (Grabage Collect)를 발생시키게 된다. 이를 통한 성능적인 이슈가 있을 수 있다.
또한, 일단 Java 프로그램의 Heap 메모리 사용량이 -Xms 에 다 다르면 OS에게 추가적인 메모리 할당을 요구하게 된다.
이렇게 해서 -Xmx 옵션으로 지정한 메모리 크기까지 메모리 할당을 받을 수 있는 것인데, OS에게 메모리 할당하는 부분에서 추가적인 시간이 필요하고 이 부분에서 성능적인 이슈가 발생할 수 있다.

상용환경에서는 처음부터 -Xmx 으로 지정한 Heap 메모리 크기를 가지고 시작하는 것이 좋고, 결국엔 -Xms 로 지정한 메모리 크기와 -Xmx 로 지정한 메모리 크기를 같게해 Java 프로그램을 구동하게 되는 것이다.

힙메모리 추가 할당시 딜레이가 걸리기 때문에 xmx, xms 를 동일하게 세팅해서 띄웠다
동일해야 모니터링에 변동성이 없어서 더 좋다 알람설정에도 편하고 false alarm 이 줄어듬

--- 

JVM의 힙 메모리 용량을 따로 지정하지 않아서 장애가 종종 발생한다. 기본 메모리 최대 크기로 설정이 되었는데 그 크기가 너무 작았기 때문이다.

시스템 메모리가 4G인 EC2 인스턴스 타입의 메모리를 충분히 못 쓰고 힙 메모리가 1G까지만 쓰이고 있었다.

최근 자바의 힙 메모리 최대 크기는 이렇게 결정됩니다.
- 시스템 메모리가 2G 이하이면, 시스템 메모리의 50% 크기까지 힙 메모리로 사용
- 메모리가 2G를 넘으면, 시스템 메모리의 25% 크기까지 힙 메모리로 사용

> 터미널에서 다음 명령을 입력하면 JVM의 각종 메모리 관련 값이 출력되는데 메모리가 16G인 제 맥북에서는 최대 힙 메모리 크기가 4G로 나옵니다.
java -XX:+PrintFlagsFinal -version 2>&1 | grep -i -E 'heapsize|permsize|version'

EC2 인스턴스들은 보통 서비스를 돌리는 일 외에는 따로 하는 일이 없으므로, 힙 메모리를 시스템 메모리의 50% 이상으로 설정하는 것이 좋다.
(가장 좋은 것은 정확히 힙이 쓸 수 있는 가용 메모리를 측정해서 이 수치를 지정하는 것)

한 EC2 인스턴스에서 여러 프로세스를 돌릴 거라면 불필요한 자원(메모리)를 반납하도록 설정하는 게 좋겠지만 어차피 JVM 프로세스 하나가 독점할 EC2 인스턴스라서 그럴 필요가 없습니다.
(사실 JVM이 메모리를 잘 반납하지도 못한다고 한다)

JVM 옵션 중에 최대 힙 메모리 지정 옵션은 -Xmx와 -XX:MaxRAMPercentage 최소 힙 메모리 지정 옵션은 -Xms와 -XX: MinRAMPercentage 가 있는데,
도커나 VM 을 쓸 때는 -Xmx 옵션보다는 -XX:MaxRAMPercentage 를 쓰는 게 낫다. (시스템 메모리가 수시로 바뀔 수 있기 때문에)


