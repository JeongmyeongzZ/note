쿠버네티스란 강력한 도구가 등장했다. 쿠버네티스가 도커 사용을 중단한다는 소식이 있었다. 그리고, 도커의 미래나 위상이 흔들린다거나 위협받고 있다는 글이 종종 보인다. 그 글에는 OCI, CRI 와 같은 용어들이 항상 등장하는데 이들은 무엇을 의미할까?


# CRI (Container Runtime Interface) ?

CRI는 쿠버네티스에서 만든 컨테이너 런타임 인터페이스로 개발자들의 컨테이너 런타임 구축에 대한 진입 장벽을 낮추어 준다.

기본적으로 도커 기반의 쿠버네티스는 다음과 같은 구조로 작동을 했었다. Kubelet이 명령을 받으면, Docker runtime을 통해서 컨테이너를 생성하거나 삭제하는 것과 같은 생명 주기를 관리하는 구조를 가지고 있었다. 

그런데, Docker 이외에도 여러가지 컨테이너 기술이 나오면서 쿠버네티스에서 이런 다양한 컨테이너 런타임에 대한 지원 요건이 생기기 시작하였고, 다양한 컨테이너 런타임을 지원하기 위해서 그때 마다 Kubelet의 코드를 수정해야 하는 문제가 생겼다.

그래서, kubelet의 코드를 수정하지 않고, 다양한 컨테이너 런타임을 지원하기 위해서, kubelet과 컨테이너 런타임 사이의 인터페이스를 통일화하는 스펙이 등장하였는데, 이것이 CRI (Container Runtime Interface)이다. 

컨테이너의 생성,삭제 등의 생명 주기를 관리하는 스펙으로 gRPC 기반의 API 스펙으로 되어 있고, 새로운 컨테이너 런타임은 CRI 스펙에 맞춰서 CRI 컴포넌트를 구현하면 되는 구조가 되었다. 

새로운 컨테이너를 대응해야하면, 새로운 CRI 를 컴포넌트 형태로 추가할 수 있는 구조가 된 것이다.

그런데... 이것조차 너무나 빈번해진다. CRI 가 계속해서 추가되어야 하는 상황이었고, 이 런타임을 규격화, 표준화하고자 할 수 없을까 ? 해서 나온 스펙이 `OCI` 이다.

OCI 스펙을 맞춰서 구현된 컨테이너 런타임을 별도의 CRI 구현이 없이 OCI 를 지원하는 CRI 구현체에 의해서 관리가 가능해진다. 

OCI 스펙에 따른 컨테이너 런타임을 관리하는 CRI 컴포넌트는 CRI-O 라는 컴포넌트로 구현되어 있다. 즉 OCI 스펙을 준수한다면, CRI-O를 통해서 kubelet으로 부터 명령을 받을 수 있는 구조가 된다. 



# OCI (Open Container Initiative) ?

먼저 배경에 대해 볼 필요가 있다. 컨테이너란 용어는 개발자라면 이제 익숙한 단어가 됐다.

이 컨테이너에 대한 관심이 급격히 증가하면서, 대형 IT 벤더와 클라우드사들은 컨테이너 기반의 솔루선을 발표하게 됐다. 도커라는 강력한 도구가 사실상 이 표준이 되었지만, 도커와는 다른 규격의 기반의 솔루션도 많아진 상황.

CoreOS, AWS, 구글, 마이크로소프트, IBM 등 주요 플랫폼 벤더들은 애플리케이션 이식성(Portability)의 관점에서 컨테이너 포맷과 런타임에 대한 개방형 업계 표준을 만들기 위해 OCI(Open Container Initiative)를 구성하였다.

이후 컨테이너 시장은 OCI의 런타임 명세와 이미지 명세를 준수하는 방향으로 성장하였고 그 과정에서 2016년 12월 쿠버네티스(Kubernetes)의 컨테이너 런타임을 만들기 위한 CRI(Container Runtime Interface)가 등장했다.



---

런타임 (컨테이너 이미지를 가져오고, 실행하는 역할을 한다.)
- 실제 컨테이너를 실행하는 저수준 컨테이너 런타임인 OCI 런타임과 (runC)
- 컨테이너 이미지의 전송 및 관리, 이미지 압축 풀기 등을 실행하는 고수준 컨테이너 런타임으로 나뉘게 되었다 (containerd)

쿠버네티스 클러스터는 containerd 가 정말 필요로 하는 것들을 확보하기 위해서 도커심(Dockershim) 이라는 다른 도구를 사용해야 했다.  
도커가 CRI 를 지키고 있지 않기 때문에 Dockershim 과 같은 도구를 사용해야하는 상황, 이것은 아름답지 못하다.



사실상 컨테이너 표준으로 사용되던 도커의 역할을 대신하는 다양한 기술이 나오고 있으며 그 중 Buildah, Podman, Skopeo는 도커의 기능을 역할별로 나눠 구현하고 있다. 이들은 또한 도커의 보안 관련 단점을 보완하며 기존에는 없던 편리한 기능도 추가로 제공한다.



_참고_
- _https://www.s-core.co.kr/insight/view/oci%EC%99%80-cri-%EC%A4%91%EC%8B%AC%EC%9C%BC%EB%A1%9C-%EC%9E%AC%ED%8E%B8%EB%90%98%EB%8A%94-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%83%9D%ED%83%9C%EA%B3%84-%ED%9D%94%EB%93%A4%EB%A6%AC%EB%8A%94/_
- _https://bcho.tistory.com/1353_
- _https://kubernetes.io/ko/blog/2020/12/02/dont-panic-kubernetes-and-docker/_
